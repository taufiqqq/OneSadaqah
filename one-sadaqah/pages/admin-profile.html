<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="apple-touch-icon" sizes="76x76" href="../assets/img/apple-icon.png">
  <link rel="icon" type="image/png" href="../assets/img/logo-onesadaqah.png">
  <title>
    OneSadaqah
  </title>
  <!--     Fonts and icons     -->
  <link rel="stylesheet" type="text/css"
    href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,900|Roboto+Slab:400,700" />
  <!-- Nucleo Icons -->
  <link href="../assets/css/nucleo-icons.css" rel="stylesheet" />
  <link href="../assets/css/nucleo-svg.css" rel="stylesheet" />
  <!-- Font Awesome Icons -->
  <script src="https://kit.fontawesome.com/42d5adcbca.js" crossorigin="anonymous"></script>
  <!-- Material Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
  <!-- CSS Files -->
  <link id="pagestyle" href="../assets/css/material-dashboard.css?v=3.1.0" rel="stylesheet" />

</head>
<!-- Nepcha Analytics (nepcha.com) -->
<!-- Nepcha is a easy-to-use web analytics. No cookies and fully compliant with GDPR, CCPA and PECR. -->
<script defer data-site="YOUR_DOMAIN_HERE" src="https://api.nepcha.com/js/nepcha-analytics.js"></script>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="../config.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<style>
  .table-container {

    max-width: 100%;
    margin: 0 auto;
    padding: 20px;
    background: #f5f7fa;
    /* Soft background color */
    border-radius: 8px;
    /* Rounded corners for the container */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    /* Subtle shadow for depth */
    overflow: hidden;
    /* Ensures no overflow */
  }

  .table-wrapper {
    width: 100%;
    overflow: hidden;
    /* Ensures no overflow */
    margin-bottom: 20px;
    /* Space between tables */
    border-radius: 8px;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    background: #ffffff;
    /* White background for table */
    border-radius: 8px;
    /* Rounded corners for the table */
    overflow: hidden;
    /* Ensures rounded corners are visible */
  }

  th,
  td {
    border: 1px solid #ddd;
    padding: 12px;
    /* Increased padding for more space */
    font-size: 13px;
    /* Increased font size for better readability */
    text-align: center;
    /* Centered text */
  }

  th {
    background-color: #6c7ae0;
    /* Soft blue background for headers */
    color: #ffffff;
    /* White text for headers */
    text-transform: uppercase;
    /* Uppercase headers */
    font-weight: 600;
    /* Bold headers */
  }

  tr:nth-child(even) {
    background-color: #f9f9f9;
  }

  tr:hover {
    background-color: #e0e7ff;
    /* Light blue background on hover */
  }

  h2,
  h3 {
    text-align: center;
    /* Centered headings */
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    /* Modern font family */
    color: #333;
    /* Dark gray text color */
  }

  h2 {
    font-size: 24px;
    /* Larger font size for main heading */
    margin-bottom: 20px;
    /* Space below main heading */
  }

  h3 {
    font-size: 20px;
    /* Larger font size for subheadings */
    margin-top: 20px;
    /* Space above subheadings */
    margin-bottom: 10px;
    /* Space below subheadings */
  }

  p {
    text-align: center;
    /* Centered text */
    font-size: 16px;
    /* Increased font size for paragraph text */
    color: #777;
    /* Light gray text color */
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    /* Modern font family */
  }

  /* button {
    width: 150px;
    height: 40px;
    border-radius: 5px;
  } */

  #popup {
    display: none;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    position: fixed;
    background-color: rgba(50, 50, 50, 0.9);
  }

  #form {
    position: absolute;
    background-color: #f5f5f5;
    border: 1px solid #212121;
    border-radius: 10px;
    padding: 20px;
    width: 400px;
    left: 50%;
    top: 10%;
    margin-left: -150px;
  }

  input {
    width: 350px;
    margin-bottom: 20px;
  }

  textarea {
    width: 350px;
    margin-bottom: 20px;
  }

  #close {
    position: absolute;
    top: 10px;
    right: 10px;
    font-weight: bold;
    width: 30px;
    height: 27px;
    background: none;
    border: none;
    cursor: pointer;
  }

  p1 {
    float: left;
    margin-left: 30px;
  }

  .cont {
    background-color: #e3f2fd;
    border-radius: 2px;
    padding: 20px 50px;
    width: 350px;
    margin: 10px auto 10px auto;
    text-align: left;
    overflow: auto;
  }

  #add {
    margin: 10px;
  }
</style>
</head>

<body class="g-sidenav-show bg-gray-200">
  <aside
    class="sidenav navbar navbar-vertical navbar-expand-xs border-0 border-radius-xl my-3 fixed-start ms-3   bg-gray-900"
    id="sidenav-main">
    <div class="sidenav-header">
      <i class="fas fa-times p-3 cursor-pointer text-white opacity-5 position-absolute end-0 top-0 d-none d-xl-none"
        aria-hidden="true" id="iconSidenav"></i>
      <a class="navbar-brand m-0" target="_blank">
        <center><img src="../assets/img/logo-onesadaqah.png" class="navbar-brand-img h-100" alt="main_logo"></center>
      </a>
    </div>
    <hr class="horizontal light mt-0 mb-2">
    <div class="collapse navbar-collapse  w-auto " id="sidenav-collapse-main">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link text-white " href="../pages/dashboard.html">
            <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">dashboard</i>
            </div>
            <span class="nav-link-text ms-1">Dashboard</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white " href="../pages/Zakat.html">
            <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">view_in_ar</i><!-- Tukar icon -->
            </div>
            <span class="nav-link-text ms-1">Zakat</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white " href="../pages/Charity.html">
            <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">table_view</i>
            </div>
            <span class="nav-link-text ms-1">Charity</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white " href="../pages/billing.html">
            <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">receipt_long</i>
            </div>
            <span class="nav-link-text ms-1">Billing</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white " href="../pages/fidyah.html">
            <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">notifications</i>
            </div>
            <span class="nav-link-text ms-1">Fidyah</span>
          </a>
        </li>
        <li class="nav-item mt-3">
          <h6 class="ps-4 ms-2 text-uppercase text-xs text-white font-weight-bolder opacity-8">Account pages</h6>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white active bg-gradient-info" href="../pages/profile.html">
            <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">person</i>
            </div>
            <span class="nav-link-text ms-1">Profile</span>
          </a>
        </li>
      </ul>
    </div>
  </aside>
  <main class="main-content position-relative max-height-vh-100 h-100 border-radius-lg" id="myApp">
    <!-- Navbar -->
    <nav class="navbar navbar-main navbar-expand-lg px-0 mx-4 shadow-none border-radius-xl" id="navbarBlur"
      data-scroll="true">
      <div class="container-fluid py-1 px-3">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb bg-transparent mb-0 pb-0 pt-1 px-0 me-sm-6 me-5">
            <li class="breadcrumb-item text-sm"><a class="opacity-5 text-dark" href="javascript:;">Pages</a></li>
            <li class="breadcrumb-item text-sm text-dark active" aria-current="page">Profile</li>
          </ol>
          <h6 class="font-weight-bolder mb-0">Profile</h6>
        </nav>

        <div class="collapse navbar-collapse mt-sm-0 mt-2 me-md-0 me-sm-4" id="navbar">

          <div class="ms-md-auto pe-md-3 d-flex align-items-center">
            <div class="input-group input-group-outline">

              <div class="wallet-container d-flex align-items-center">
                <img src="../assets/img/icons8-wallet.png" alt="Wallet Icon" class="wallet-icon me-2" />
                <span class="wallet-balance">{{ tokenBalance }}</span>
              </div>
            </div>
          </div>

          <ul class="navbar-nav  justify-content-end">


            <li class="nav-item d-xl-none ps-3 d-flex align-items-center">
              <a href="javascript:;" class="nav-link text-body p-0" id="iconNavbarSidenav">
                <div class="sidenav-toggler-inner">
                  <i class="sidenav-toggler-line"></i>
                  <i class="sidenav-toggler-line"></i>
                  <i class="sidenav-toggler-line"></i>
                </div>
              </a>
            </li>
            <li class="nav-item px-3 d-flex align-items-center">
              <a href="javascript:;" class="nav-link text-body p-0">
                <i class="fa fa-cog fixed-plugin-button-nav cursor-pointer"></i>
              </a>
            </li>
            <!-- notification drop down -->
            <li class="nav-item dropdown pe-2 d-flex align-items-center">
              <a href="javascript:;" class="nav-link text-body p-0" id="dropdownMenuButton" data-bs-toggle="dropdown"
                aria-expanded="false">
                <i class="fa fa-bell cursor-pointer"></i>
              </a>
              <ul class="dropdown-menu  dropdown-menu-end  px-2 py-3 me-sm-n4" aria-labelledby="dropdownMenuButton">
                <li class="mb-2">
                  <a class="dropdown-item border-radius-md" href="javascript:;">
                    <div class="d-flex py-1">
                      <div class="my-auto">
                        <img src="../assets/img/team-2.jpg" class="avatar avatar-sm  me-3 ">
                      </div>
                      <div class="d-flex flex-column justify-content-center">
                        <h6 class="text-sm font-weight-normal mb-1">
                          <span class="font-weight-bold">New message</span> from Laur
                        </h6>
                        <p class="text-xs text-secondary mb-0">
                          <i class="fa fa-clock me-1"></i>
                          13 minutes ago
                        </p>
                      </div>
                    </div>
                  </a>
                </li>
                <li class="mb-2">
                  <a class="dropdown-item border-radius-md" href="javascript:;">
                    <div class="d-flex py-1">
                      <div class="my-auto">
                        <img src="../assets/img/small-logos/logo-spotify.svg"
                          class="avatar avatar-sm bg-gradient-dark  me-3 ">
                      </div>
                      <div class="d-flex flex-column justify-content-center">
                        <h6 class="text-sm font-weight-normal mb-1">
                          <span class="font-weight-bold">New album</span> by Travis Scott
                        </h6>
                        <p class="text-xs text-secondary mb-0">
                          <i class="fa fa-clock me-1"></i>
                          1 day
                        </p>
                      </div>
                    </div>
                  </a>
                </li>
                <li>
                  <a class="dropdown-item border-radius-md" href="javascript:;">
                    <div class="d-flex py-1">
                      <div class="avatar avatar-sm bg-gradient-secondary  me-3  my-auto">
                        <svg width="12px" height="12px" viewBox="0 0 43 36" version="1.1"
                          xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                          <title>credit-card</title>
                          <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                            <g transform="translate(-2169.000000, -745.000000)" fill="#FFFFFF" fill-rule="nonzero">
                              <g transform="translate(1716.000000, 291.000000)">
                                <g transform="translate(453.000000, 454.000000)">
                                  <path class="color-background"
                                    d="M43,10.7482083 L43,3.58333333 C43,1.60354167 41.3964583,0 39.4166667,0 L3.58333333,0 C1.60354167,0 0,1.60354167 0,3.58333333 L0,10.7482083 L43,10.7482083 Z"
                                    opacity="0.593633743"></path>
                                  <path class="color-background"
                                    d="M0,16.125 L0,32.25 C0,34.2297917 1.60354167,35.8333333 3.58333333,35.8333333 L39.4166667,35.8333333 C41.3964583,35.8333333 43,34.2297917 43,32.25 L43,16.125 L0,16.125 Z M19.7083333,26.875 L7.16666667,26.875 L7.16666667,23.2916667 L19.7083333,23.2916667 L19.7083333,26.875 Z M35.8333333,26.875 L28.6666667,26.875 L28.6666667,23.2916667 L35.8333333,23.2916667 L35.8333333,26.875 Z">
                                  </path>
                                </g>
                              </g>
                            </g>
                          </g>
                        </svg>
                      </div>
                      <div class="d-flex flex-column justify-content-center">
                        <h6 class="text-sm font-weight-normal mb-1">
                          Payment successfully completed
                        </h6>
                        <p class="text-xs text-secondary mb-0">
                          <i class="fa fa-clock me-1"></i>
                          2 days
                        </p>
                      </div>
                    </div>
                  </a>
                </li>
              </ul>
            </li>
            <li class="nav-item d-flex align-items-center">
              <a href="../pages/profile.html" class="nav-link text-body font-weight-bold px-0">
                <i class="fa fa-user me-sm-1"></i>
              </a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <!-- End Navbar -->

    <div class="container-fluid px-2 px-md-4">
      <div class="page-header min-height-300 border-radius-xl mt-4"
        style="background-image: url('https://images.unsplash.com/photo-1531512073830-ba890ca4eba2?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&ixlib=rb-1.2.1&auto=format&fit=crop&w=1920&q=80');">
        <span class="mask  bg-gradient-success  opacity-6"></span>
      </div>
      <div class="card card-body mx-3 mx-md-4 mt-n6">
        <div class="row gx-4 mb-2">
          <div class="col-auto">
            <div class="avatar avatar-xl position-relative">
              <img src="../assets/img/maiwp.jpeg" alt="profile_image" class="w-100 border-radius-lg shadow-sm">
            </div>
          </div>
          <div class="col-auto my-auto">
            <div class="h-100">
              <h5 class="mb-1">
                MAIWP
              </h5>
              <p class="mb-0 font-weight-normal text-sm">
                Admin
              </p>
            </div>
          </div>
          <div class="col-auto my-auto ms-md-auto">
            <a class="btn btn-info" style="align-self: flex-end; margin-top: auto;" href="profile.html">Change
              View</a>
          </div>
          <div>
          <button id="add" onclick="show()" class="btn btn-info ms-md-auto">Add Organization </button>
        </div>
        <div class="row gx-4 mb-2">
          <div class="col-auto my-auto">
            <!-- <button id="add" onclick="show()" class="btn btn-info ms-md-auto">Add Organization </button> -->

            <div id="popup">

              <form id="form">
                <button type="button" id="close" onclick="hide()">X</button>
                <br>
                <p1>Organization Name:</p1>
                <br>
                <input id="name" name="name" type="text" />
                <br>
                <p1>Person In Charge Identification Card:</p1>
                <br>
                <input id="pic_ic" name="ic" type="text" />
                <br>
                <p1>Person In Charge Phone Number:</p1>
                <br>
                <input id="pic_pnum" name="pnum" type="text" />
                <br>
                <p1>Person In Charge Email:</p1>
                <br>
                <input id="pic_email" name="email" type="email" />
                <br>
                <p1>Description:</p1>
                <br>
                <textarea id="description" name="description" type="text" rows="4"></textarea>
                <br>
                <input type="hidden" id="adminref" name="adminref" value="1">

                <button type="button" id="submit" onclick="add()">Submit</button>
              </form>
            </div>
            <div id="results">
              <div class="table-container">
                <h3>Organization List</h3>
                <table id="resultsTable" border="1">
                  <thead>
                    <tr>
                      <th class="bg-gradient-info" rowspan="2">Name</th>
                      <th class="bg-gradient-info" rowspan="2">Description</th>
                      <th class="bg-gradient-info" rowspan="2">Wallet Address</th>
                      <th class="bg-gradient-info" colspan="3">Person In Charge</th>
                      <th class="bg-gradient-info" rowspan="2">Fund</th>
                    </tr>
                    <tr>
                      <th class="bg-gradient-info">IC Number</th>
                      <th class="bg-gradient-info">Phone Number</th>
                      <th class="bg-gradient-info">Email</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>Islamic Relief Malaysia</td>
                      <td>Islamic Relief Malaysia continues to be proactive in helping those in need locally or abroad regardless of any differences through the mySedekah campaign which covers various aid sectors such as food, emergency, community development, health, education, water sanitation & hygiene, and others.</td>
                      <td>0x3F2390100afd70455Cf007172c3dbE1c0097A481</td>
                      <td>023456-78-9012</td>
                      <td>0123456789</td>
                      <td>dummyemail@gmail.com</td>
                      <td>
                        <a href="../pages/payment_charityAdmin.html" class="text-success font-weight-bold text-xs"
                          data-toggle="tooltip" data-original-title="Edit user">Add Fund</a>
                      </td>
                    </tr>
                    <tr v-for="org in organizations" :key="org.id">
                      <td>{{ org.name }}</td>
                      <td>{{ org.description }}</td>
                      <td>{{ org.wallet_address }}</td>
                      <td>{{ org.pic_ic }}</td>
                      <td>{{ org.pic_pnum }}</td>
                      <td>{{ org.pic_email }}</td>
                      <td>
                        <a href="../pages/payment_charity.html" class="text-success font-weight-bold text-xs"
                          data-toggle="tooltip" data-original-title="Edit user">Add Fund</a>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        <br>
        <div class="table-container">
          <h2>Transactions History</h2>
          <div class="transaction-container">
            <div v-if="transactions.length" class="col-lg-7 col-md-6">
              <div class="card h-100">
                <div class="card-header pb-0 bg-gradient-info">
                  <h4 class="text-white">Charity</h4>
                </div>
                <div class="card-body p-3 transaction-list">
                  <div v-for="transaction in transactions" :key="transactions.transactionHash" class="card-body p-3">
                    <div class="timeline timeline-one-side">
                      <div class="timeline-block mb-3">
                        <span class="timeline-step">
                          <i class="material-icons text-dark text-gradient">payments</i>
                        </span>
                        <div class="timeline-content">
                          <h6 class="text-dark text-sm font-weight-bold mb-0">Transaction ID</h6>
                          <p class="text-secondary font-weight-bold text-xs mt-1 mb-2">{{ transaction.transactionHash }}
                          </p>
                          <h6 class="text-dark text-sm font-weight-bold mb-0">From</h6>
                          <p class="text-secondary font-weight-bold text-xs mt-1 mb-2">{{ transaction.from }}</p>
                          <h6 class="text-dark text-sm font-weight-bold mb-0">To</h6>
                          <p class="text-secondary font-weight-bold text-xs mt-1 mb-2">{{ transaction.to }}</p>
                          <h6 class="text-dark text-sm font-weight-bold mb-0">Amount</h6>
                          <p class="text-secondary font-weight-bold text-xs mt-1 mb-2">{{
                            (transaction.amount).substring(0,transaction.amount.length-18) }} {{
                            transaction.token.symbol
                            }}</p>
                          <h6 class="text-dark text-sm font-weight-bold mb-0">Date and Time</h6>
                          <p class="text-secondary font-weight-bold text-xs mt-1 mb-0">{{ transaction.timestamp }}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div v-else>
              <p>No Charity transactions available.</p>
            </div>

            <div v-if="transactionsZakat.length" class="col-lg-7 col-md-6">
              <div class="card h-100">
                <div class="card-header pb-0 bg-gradient-info">
                  <h4 class="text-white">Zakat</h4>
                </div>
                <div class="card-body p-3 transaction-list">
                  <div v-for="transaction in transactionsZakat" :key="transactionsZakat.transactionHash" class="card-body p-3">
                    <div class="timeline timeline-one-side">
                      <div class="timeline-block mb-3">
                        <span class="timeline-step">
                          <i class="material-icons text-dark text-gradient">payments</i>
                        </span>
                        <div class="timeline-content">
                          <h6 class="text-dark text-sm font-weight-bold mb-0">Transaction ID</h6>
                          <p class="text-secondary font-weight-bold text-xs mt-1 mb-2">{{ transaction.transactionHash }}
                          </p>
                          <h6 class="text-dark text-sm font-weight-bold mb-0">From</h6>
                          <p class="text-secondary font-weight-bold text-xs mt-1 mb-2">{{ transaction.from }}</p>
                          <h6 class="text-dark text-sm font-weight-bold mb-0">To</h6>
                          <p class="text-secondary font-weight-bold text-xs mt-1 mb-2">{{ transaction.to }}</p>
                          <h6 class="text-dark text-sm font-weight-bold mb-0">Amount</h6>
                          <p class="text-secondary font-weight-bold text-xs mt-1 mb-2">{{
                            (transaction.amount).substring(0,transaction.amount.length-18) }} {{ transaction.token.symbol
                            }}</p>
                          <h6 class="text-dark text-sm font-weight-bold mb-0">Date and Time</h6>
                          <p class="text-secondary font-weight-bold text-xs mt-1 mb-0">{{ transaction.timestamp }}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div v-else>
              <p>No Zakat transactions available.</p>
            </div>
          </div>
        </div>

      </div>
    </div>

    <!--   Core JS Files   -->
    <script src="../assets/js/core/popper.min.js"></script>
    <script src="../assets/js/core/bootstrap.min.js"></script>
    <script src="../assets/js/plugins/perfect-scrollbar.min.js"></script>
    <script src="../assets/js/plugins/smooth-scrollbar.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    </head>
    <script>
      var win = navigator.platform.indexOf('Win') > -1;
      if (win && document.querySelector('#sidenav-scrollbar')) {
        var options = {
          damping: '0.5'
        };
        Scrollbar.init(document.querySelector('#sidenav-scrollbar'), options);
      }
    </script>
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <script src="../assets/js/material-dashboard.min.js?v=3.1.0"></script>

    <!-- Vue.js App -->
    <script>
      const vueApp = Vue.createApp({
        data() {
          return {
            client_id: window.env.client_id,
            client_secret: window.env.client_secret,
            balanceWalletAddress: "",
            balanceContractAddress: "",
            tokenBalance: null,
            transferInput: {
              customAmount: "1",
            },
            transferWalletAddress: "",
            transferToAddress: "",
            transferAmount: "",
            transferContractAddress: "",
            callbackUrl: "",
            transferResponse: null,
            transactionFilter: "to",
            transactions: [],
            transactionsZakat: [],
            organizations: [],
          };
        },
        mounted() {
          this.fetchTokenBalance();
          this.fetchTransactions();
          this.fetchTransactionsZakat();
          this.fetchOrganizations();
        },
        methods: {
          async fetchTokenBalance() {
            const payload = {
              wallet_address: window.env.wallet_address2,
              contract_address: window.env.transferContractAddress,
            };

            try {
              const res = await axios.post(
                "https://service-testnet.maschain.com/api/token/balance",
                payload,
                {
                  headers: {
                    client_id: this.client_id,
                    client_secret: this.client_secret,
                  },
                }
              );

              const rawBalance = parseFloat(res.data.result);

              this.tokenBalance = rawBalance.toFixed(2) + ' SDQ';
            } catch (error) {
              console.error("Error fetching token balance:", error);
              this.tokenBalance = error.response ? error.response.data : "An error occurred";
            }
          },
          async transferTokens() {
            console.log(this.transferInput.customAmount);

            if (!this.transferInput.customAmount) {
              alert("Please fill in the amounts");
              return;
            }

            this.transferAmount = this.transferInput.customAmount;

            const payload = {
              wallet_address: window.env.wallet_address2,
              to: window.env.transferToAddress1,
              amount: this.transferAmount,
              contract_address: window.env.transferContractAddress,
              callback_url: window.env.callbackUrl,
            };

            try {
              const res = await axios.post(
                "https://service-testnet.maschain.com/api/token/token-transfer",
                payload,
                {
                  headers: {
                    client_id: this.client_id,
                    client_secret: this.client_secret,
                  },
                }
              );
              this.transferResponse = res.data.result;
              alert("Transfer successful!");
            } catch (error) {
              console.error("Error transferring tokens:", error);
              this.transferResponse = error.response ? error.response.data : "An error occurred";
              alert("Error transferring tokens. Please try again.");
            }
          },
          async fetchTransactions() {
            const walletAddress = window.env.transferToAddress1;
            const contractAddress = window.env.transferContractAddress;
            const filter = 'to'; // or 'from'

            const url = `https://service-testnet.maschain.com/api/token/get-token-transaction?wallet_address=${encodeURIComponent(walletAddress)}&contract_address=${encodeURIComponent(contractAddress)}&filter=${encodeURIComponent(filter)}`;

            try {
              const response = await fetch(url, {
                headers: {
                  'client_id': this.client_id,
                  'client_secret': this.client_secret,
                  'content-type': 'application/json'
                }
              });

              if (!response.ok) {
                throw new Error('Network response was not ok');
              }

              const data = await response.json();
              this.transactions = data.result || [];
            } catch (error) {
              console.error('Error fetching transactions:', error);
            }
          },
          async fetchTransactionsZakat() {
            const walletAddress = window.env.wallet_address3;
            const contractAddress = window.env.transferContractAddress;
            const filter = 'to'; // or 'from'

            const url = `https://service-testnet.maschain.com/api/token/get-token-transaction?wallet_address=${encodeURIComponent(walletAddress)}&contract_address=${encodeURIComponent(contractAddress)}&filter=${encodeURIComponent(filter)}`;

            try {
              const response = await fetch(url, {
                headers: {
                  'client_id': this.client_id,
                  'client_secret': this.client_secret,
                  'content-type': 'application/json'
                }
              });

              if (!response.ok) {
                throw new Error('Network response was not ok');
              }

              const data = await response.json();
              this.transactionsZakat = data.result || [];
            } catch (error) {
              console.error('Error fetching transactions:', error);
            }
          },
          async fetchOrganizations() {
            try {
              const response = await fetch('../database/getOrganizationById.php');
              const organizations = await response.json();
              this.organizations = organizations;
            } catch (error) {
              console.error('Error fetching organizations:', error);
            }
          },
        },
      });
      vueApp.mount("#myApp");
    </script>

    <!-- jQuery Script for Popup -->
    <script>
      function show() {
        alert('This feature is not included in this deployment. To implement it, refer the README.md to setup the database.');
        //document.getElementById("popup").style.display = "block";
      }

      function hide() {
        const popup = document.getElementById("popup");
        if (popup) {
          popup.style.display = "none";
        }

        const elements = ["name", "pic_email", "pic_ic", "description", "pic_pnum"];
        elements.forEach(id => {
          const element = document.getElementById(id);
          if (element) {
            element.value = "";
          }
        });
      }

      async function add() {
        var name = document.getElementById("name").value;
        var email = document.getElementById("pic_email").value;
        var description = document.getElementById("description").value;
        var ic = document.getElementById("pic_ic").value;
        var pnum = document.getElementById("pic_pnum").value;
        var adminref = document.getElementById("adminref").value;

        if (name === "" || description === "" || ic === "" || pnum === "" || email === "") {
          alert("Please fill all fields.");
          return; // Early exit if validation fails
        }

        console.log("name " + name);
        console.log("description " + description);
        console.log("ic " + ic);
        console.log("pnum " + pnum);
        console.log("email " + email);
        console.log("adminref " + adminref);

        try {
          // First, create the wallet in MasChain
          const walletPayload = {
            name: name,
            email: email,
            ic: ic,
            phone: pnum
          };

          const walletResponse = await fetch('https://service-testnet.maschain.com/api/wallet/create-user', {
            method: 'POST',
            headers: {
              'client_id': window.env.client_id,
              'client_secret': window.env.client_secret,
              'content-type': 'application/json'
            },
            body: JSON.stringify(walletPayload)
          });

          const walletResult = await walletResponse.json();

          // Log the walletResult to check its structure
          console.log('Wallet API Response:', walletResult);

          if (walletResult.status === 200 && walletResult.result && walletResult.result.wallet) {
            const walletAddress = walletResult.result.wallet.wallet_address;

            // Log walletAddress to confirm it's being received correctly
            console.log('Wallet Address:', walletAddress);

            // Second, add the organization to the database with the wallet address
            const formData = new FormData();
            formData.append('name', name);
            formData.append('description', description);
            formData.append('wallet_address', walletAddress);
            formData.append('pic_ic', ic);
            formData.append('pic_pnum', pnum);
            formData.append('pic_email', email);
            formData.append('adminref', adminref);

            const response = await fetch('../database/createOrganization.php', {
              method: 'POST',
              body: formData
            });

            const result = await response.json();

            console.log('Create Organization Response:', result);

            if (result.status === 'success') {
              alert('Organization and wallet added successfully!');
              hide();
            } else {
              alert('Error adding organization: ' + result.message);
            }
          } else {
            alert('Error creating wallet: ' + (walletResult.message || 'Unknown error'));
          }
        } catch (error) {
          console.error('Error:', error);
          alert('An error occurred. Please try again.');
        }
      }
    </script>

</html>